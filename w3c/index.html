<!DOCTYPE html><html lang="en-US"><meta charset="utf-8">
<title>Web 通知</title>
<style>
 pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em 1em }
 pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
 pre code { color:inherit; background:transparent }
 pre.css { border: solid 0.0625em; background: #FFFFEE; color: black; padding: 0.5em 1em; }
 .example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
 .note { margin-left:2em; font-weight:bold; font-style:italic; color:#008000 }
 p.note::before { content:"Note: " }
 .XXX { padding:.5em; border:solid #f00 }
 p.XXX::before { content:"Issue: " }
 dl.switch { padding-left:2em }
 dl.switch > dt { text-indent:-1.5em }
 dl.switch > dt:before { content:'\21AA'; padding:0 0.5em 0 0; display:inline-block; width:1em; text-align:right; line-height:0.5em }
 dl.domintro { color: green; margin: 2em 0 2em 2em; padding: 0.5em 1em; border: none; background: #DDFFDD; }
 dl.domintro dt, dl.domintro dt * { color: black; text-decoration: none; }
 dl.domintro dd { margin: 0.5em 0 1em 2em; padding: 0; }
 dl.domintro dd p { margin: 0.5em 0; }
 dl.domintro:before { display: table; margin: -1em -0.5em -0.5em auto; width: auto; content: 'This box is non-normative. Implementation requirements are given below this box.'; color: red; border: solid 2px; background: white; padding: 0 0.25em; }
 em.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
 dfn { font-weight:bold; font-style:normal }
 code { color:orangered }
 code :link, code :visited { color:inherit }
 hr:not(.top) { display:block; background:none; border:none; padding:0; margin:2em 0; height:auto }
 table { border-collapse:collapse; border-style:hidden hidden none hidden }
 table thead { border-bottom:solid }
 table tbody th:first-child { border-left:solid }
 table td, table th { border-left:solid; border-right:solid; border-bottom:solid thin; vertical-align:top; padding:0.2em }

 .warning { color: red; background: transparent; font-weight: bolder; font-style: italic; }
 .warning p:first-child { margin-top: 0; }
 .warning p:last-child { margin-bottom: 0; }
 .warning:before { font-style: normal; }
 p.warning:before { content: '\26A0 Warning! '; }

 @media print {
   [data-anolis-spec]::after { content:"[" attr(data-anolis-spec) "]"; font-size:.6em; vertical-align:super; text-transform:uppercase }
 }
</style>
<link href="https://www.w3.org/StyleSheets/TR/W3C-CR" rel="stylesheet">
<div class="head">


<!--begin-logo-->
<p><a href="http://www.w3.org/"><img alt="W3C" height="48" src="https://www.w3.org/Icons/w3c_home" width="72"></a></p>
<!--end-logo-->

<h1>Web 通知</h1>
<h2 class="no-num no-toc" id="w3c-candidate-recommendation-19-may-2015">W3C 候选推荐标准 2015年5月19日</h2>

<dl>
 <dt>该版本：
 <dd class="publish"><a href="http://www.w3.org/TR/2015/CR-notifications-20150519/">http://www.w3.org/TR/2015/CR-notifications-20150519/</a>

 <dt class="publish">最新发布版本：
 <dd class="publish"><a href="http://www.w3.org/TR/notifications/">http://www.w3.org/TR/notifications/</a>

 <dt class="publish">最新编辑草案：
 <dd class="publish"><a href="http://dvcs.w3.org/hg/notifications/raw-file/tip/Overview.html">http://dvcs.w3.org/hg/notifications/raw-file/tip/Overview.html</a>

 </dd>
 <dt>版本历史：
 <dd><a href="http://dvcs.w3.org/hg/notifications/shortlog">http://dvcs.w3.org/hg/notifications/shortlog</a></dd>

 <dt>历史版本：</dt>
 <dd><a href="http://www.w3.org/TR/2013/WD-notifications-20130912/">http://www.w3.org/TR/2013/WD-notifications-20130912/</a>
 <dd><a href="http://www.w3.org/TR/2012/WD-notifications-20120614/">http://www.w3.org/TR/2012/WD-notifications-20120614/</a>
 <dd><a href="http://www.w3.org/TR/2011/WD-notifications-20110301/">http://www.w3.org/TR/2011/WD-notifications-20110301/</a>

 <dt>编辑（前任）：
 <dd>John Gregg (<a href="http://www.google.com/">Google</a>)
 &lt;<a href="mailto:johnnyg@google.com">johnnyg@google.com</a>&gt;</dd>
 <dt>编辑（<a href="https://notifications.spec.whatwg.org/">https://notifications.spec.whatwg.org/</a> 版本）：
 <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a>
 (<a href="http://www.mozilla.org/">Mozilla</a>)
 &lt;<a href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>&gt;</dd>

 <dt>译者：</dt>
 <dd><a href="https://github.com/zqzhang">张志强</a></dd>

 <dt>译者声明：</dt>
 <dd>本规范的<a href="http://www.w3.org/TR/notifications/">英文版本</a>是其唯一标准版本。 其他<a href="http://www.w3.org/Consortium/Translation/">翻译版本</a>包括该译文都是参考性的。</dd>
 <dd>虽然译者力求翻译准确，错误仍在所难免，欢迎指正。</dd>
</dl>


<!--begin-copyright-->
<p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> &copy; 2015 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>&reg;</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p>
<!--end-copyright-->

</div>

<hr class=top>

<h2 class="no-num no-toc" id="abstract">摘要</h2>

<p>Web 通知定义了一个面向终端用户推送通知的应用编程接口。Web 通知允许应用程序
在某一事件发生时，比如电子邮件的交付，在 Web 页面之外向用户提供提醒和通知。

<h2 class="no-num no-toc" id="sotd">本文档状态</h2>

<p><em>本节描述本文档发布时状态，其他文档可能取代本文档。 W3C</abbr> 最新发布的技术报告，
以及本技术报告的最新版本， 参见 <a href="http://www.w3.org/TR/">W3C 技术报告索引</a>：
http://www.w3.org/TR/ 。</em>

<p>本规范是 W3C 于2015年5月19日发布的 Web 通知候选推荐标准。
请将反馈发送至邮件列表：
<a href="mailto:public-web-notification@w3.org">public-web-notification@w3.org</a>
（<a href="http://lists.w3.org/Archives/Public/public-web-notification/">归档</a>）。

<p>W3C
<a href="http://www.w3.org/2010/web-notifications/">Web 通知工作组</a>
负责本规范的 W3C 推荐标准跟踪进展。工作组期望将本规范推至推荐标准。

<p class="alt">在
<a href="https://notifications.spec.whatwg.org/">https://notifications.spec.whatwg.org/</a>，
也有一份通知规范在开发中。
其最近的工作集中于集成通知至服务线程（Sevice Workers）及其它新特性上。
同时那份规范废弃了本规范所定义的 <code>onshow</code> 和 <code>onclose</code>
事件，其依据是这些事件缺乏足够的用例。

<p>作为候选推进标准发布并不意味着会被 W3C 成员认可。这是一份文档草案，
可能会被更新、替换或者在任何时候被其他文档取代。
将此文档作为正在进行的工作文档以外的文档，是不合适的。

<p>期望能在2015年6月19日将本规范推进至提案推荐标准。为退出候选推荐标准，
Web 通知工作组将需要纪录一份通过
<a href="https://github.com/w3c/web-platform-tests/tree/master/notifications">通知测试套件</a>
评估的符合本规范需求的有相当高水平的用户代理。

<p>本文档由一个遵循
<a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">2004年2月5日 W3C 专利政策</a>
的小组创作而成。
W3C 维护着一个与工作组交付产品相关的
<a href="http://www.w3.org/2004/01/pp-impl/45313/status" rel="disclosure">已公开的专利列表</a>；该列表页面还包括如何公开一项专利的说明。 
对某专利拥有实际知识并相信该专利包含了
<a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">基本要求</a>
的个人，必须根据
<a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 专利政策第6节</a>的要求公开这些信息。

<p>本文档受制于 <a href="http://www.w3.org/2014/Process-20140801/" id="w3c_process_revision">2005年10月14日 <abbr title="World Wide Web Consortium">W3C</abbr> 过程文档</a>。</p>

<h2 class="no-num no-toc" id="table-of-contents">目录</h2>


<!--begin-toc-->
<ul class="toc">
 <li><a href="#introduction"><span class="secno">1 </span>引言</a></li>
 <li><a href="#conformance"><span class="secno">2 </span>一致性</a>
  <ul class="toc">
   <li><a href="#security"><span class="secno">2.1 </span>安全性</a></ul></li>
 <li><a href="#terminology"><span class="secno">3 </span>术语</a></li>
 <li><a href="#model"><span class="secno">4 </span>模型</a>
  <ul class="toc">
   <li><a href="#direction-0"><span class="secno">4.1 </span>方向</a></li>
   <li><a href="#language-0"><span class="secno">4.2 </span>语言</a></li>
   <li><a href="#permission"><span class="secno">4.3 </span>许可</a></li>
   <li><a href="#notification-lists"><span class="secno">4.4 </span>通知列表</a></li>
   <li><a href="#showing-a-notification"><span class="secno">4.5 </span>显示通知</a></li>
   <li><a href="#activating-a-notification"><span class="secno">4.6 </span>激活通知</a></li>
   <li><a href="#closing-a-notification"><span class="secno">4.7 </span>关闭通知</a></li>
   <li><a href="#pending-notifications"><span class="secno">4.8 </span>等候通知</a></li>
   <li><a href="#displaying-notifications"><span class="secno">4.9 </span>展示通知</a></li>
   <li><a href="#replacing-a-notification"><span class="secno">4.10 </span>替换通知</a></ul></li>
 <li><a href="#api"><span class="secno">5 </span>应用编程接口</a></li>
 <li><a href="#examples"><span class="secno">6 </span>示例</a>
  <ul class="toc">
   <li><a href="#using-events"><span class="secno">6.1 </span>使用事件</a></li>
   <li><a href="#tags-example"><span class="secno">6.2 </span>多实例使用 <code title="">tag</code> 成员</a></li>
   <li><a href="#using-the-tag-member-for-a-single-instance"><span class="secno">6.3 </span>单实例使用 <code title="">tag</code> 成员</a></ul></li>
 <li><a class="no-num" href="#references">参考文献</a></li>
 <li><a class="no-num" href="#acknowledgments">致谢</a></ul>
<!--end-toc-->



<h2 id="introduction"><span class="secno">1 </span>引言</h2>

<p>本规范提供了一个应用编程接口来展示通知，以便在网页页面内容之外提醒用户。
它没有精确地指定一个用户代理应该如何显示这些通知; 最好呈现方式取决于用户代理
所运行的设备。 当本规范指定在“桌面”上显示通知，通常指的是网页之外的一些静态
显示区域，但也可以采取多种形式，包括：

<ul>
 <li>用户的显示器的一个角落里。
 <li>用户代理的显示窗内的区域。
 <li>移动设备的“主屏”区域。
</ul>

<p>本规范没有准确定义用户代理应该如何展示通知，设计时该应用编程接口
相对于显示选项是灵活的。

<p>本规范被设计成与现有的通知平台兼容尽可能，而且是独立于平台的。
由于常用平台不提供相同的功能，该规范将指出哪些事件是可以保证的，哪些不是。
特别地，规定在这里的通知仅可以包含文本和图标内容。

<p>通常情况下，用于通知的事件模型都是尽力而为型的；同时，
<code><a href="#notification">Notification</a></code> 对象提供了一个 <code title="">click</code> 事件，
应用程序可通过侦听该事件增强其功能，但不能依赖于接收该事件，
以防底层通知平台不提供该功能。


<h2 id="conformance"><span class="secno">2 </span>一致性</h2>

<p>像其他不具有规范性的章节一样，本规范中所有指导方案、图表、示例以及注解都不具有规范性。
本规范中其余部分均具有规范性。

<p>本规范中规范性部分所使用的关键词“必须”、“必须不”、“要求”、
“应该”、“应该不”、“推荐”、“可以”和“可选的”由 RFC2119 进行解释。
为增强阅读性，这些关键字在本规范中并不全是大写字母写就的。
<a href="#refsRFC2119">[RFC2119]</a>



<h3 id="security"><span class="secno">2.1 </span>安全性</h3>

<p>应当仅在用户已经指定对通知的期望时，才呈现通知；否则，这些通知可能会给用户带来负面体验。



<h2 id="terminology"><span class="secno">3 </span>术语</h2>

<p>本规范所使用的大多数术语取自 DOM、HTML、IDL 和 URL。
<a href="#refsDOM">[DOM]</a>
<a href="#refsHTML">[HTML]</a>
<a href="#refsWEBIDL">[WEBIDL]</a>
<a href="#refsURL">[URL]</a>



<h2 id="model"><span class="secno">4 </span>模型</h2>

<p><dfn id="concept-notification" title="concept-notification">notification</dfn> 
允许在网页上下文之外提醒用户事件发生了，比如电子邮件的交付。

<p>每个 <a href="#concept-notification" title="concept-notification">notification</a> 都有一个
<dfn id="title">title</dfn>、 <dfn id="direction">direction</dfn>、
<dfn id="language">language</dfn>、 和一个 <dfn id="origin">origin</dfn>。

<p>每个 <a href="#concept-notification" title="concept-notification">notification</a> <em>都可以</em>
有一个关联的 <dfn id="body">body</dfn>、 <dfn id="tag">tag</dfn>、 <dfn id="icon-url">icon URL</dfn>、 和
<dfn id="icon-image">icon image</dfn>。

<p class="note">不鼓励开发者通过图标、声音或振动模式来给最终用户传达信息；
除非这些信息是最终用户可以访问的。

<h3 id="direction-0"><span class="secno">4.1 </span>方向</h3>

<p>本节所使用的术语等同于 HTML 规范中渲染部分所使用的。 <a href="#refsHTML">[HTML]</a>

<!-- 与下述规范保持一致：
     http://www.whatwg.org/specs/web-apps/current-work/#text-rendered-in-native-user-interfaces -->

<p>期望用户代理使用 Unicode 语义来解析
<a href="#concept-notification" title="concept-notification">notification</a> 的 <a href="#title">title</a>
和 <a href="#body">body</a> 中的文本。
展示它们时，应视之为由双向算法规则 P1、P2 和 P3 所定义的一个或多个双向算法段落组成的独立集合，
例如包括支持换行符 U+000A (LF) 带来的段落分割。对
<a href="#title">title</a> 和 <a href="#body">body</a> 中的每一段，
<a href="#concept-notification" title="concept-notification">notification</a> 的
<a href="#direction">direction</a> 属性在其值非 "<code title="">auto</code>" 时，
将覆盖双向算法 P2 和 P3 规则。
<a href="#refsBIDI">[BIDI]</a>


<h3 id="language-0"><span class="secno">4.2 </span>语言</h3>

<!-- 与下述规范保持一致：
     http://www.whatwg.org/specs/web-apps/current-work/#attr-lang -->

<p><a href="#concept-notification" title="concept-notification">notification</a> 的
<a href="#language">language</a> 属性指定了
<a href="#concept-notification" title="concept-notification">notification</a> 的 <a href="#title">title</a>
和 <a href="#body">body</a>的主要语言。语言属性值要么是一个有效的 BCP 47 语言标记，
要么是一个空 字符串。空字符串表示主要语言是未知的。
<a href="#refsLANG">[LANG]</a>


<h3 id="permission"><span class="secno">4.3 </span>许可</h3>

<p><a href="#concept-notification" title="concept-notification">Notifications</a> 当且仅当被用户（或用户代理）授予
<dfn id="permission-0">permission</dfn> 时，才能被显示。为给定
<a class="external" href="https://tools.ietf.org/html/rfc6454#section-4">origin</a>
展示 <a href="#concept-notification" title="concept-notification">notifications</a> 的
<a href="#permission-0">permission</a> 是下面三个字符串之一： 

<dl>
 <dt>"<code title="">default</code>"
 <dd><p>相当于 "<code title="">denied</code>"，但用户没有作出明确的选择。

 <dt>"<code title="">denied</code>"
 <dd><p>意味着用户不希望被
 <a href="#concept-notification" title="concept-notification">notifications</a>。

 <dt>"<code title="">granted</code>"
 <dd><p>意味着可以展示 <a href="#concept-notification" title="concept-notification">notifications</a>。
</dl>

<p class="note">"<code title="">default</code>"
从不会等同于 "<code title="">granted</code>"。
如果那样的话，"<code title="">granted</code>" 会被滥用，
应用程序再也不必请求 <a href="#permission-0">permission</a>。


<h3 id="notification-lists"><span class="secno">4.4 </span>通知列表</h3>

<p>用户代理必须维护一个 <dfn id="list-of-pending-notifications">list of pending notifications</dfn>
和一个 <dfn id="list-of-active-notifications">list of active notifications</dfn>.

<h3 id="showing-a-notification"><span class="secno">4.5 </span>显示通知</h3>

<p>对给定 <var title="">notification</var>， 其 <dfn id="show-steps">show steps</dfn> 是：

<ol>
 <li><p>If <a href="#permission-0">permission</a> for <var title="">notification</var>'s
 <a href="#origin">origin</a> is not "<code title="">granted</code>", cancel any ongoing
 <a class="external" href="https://html.spec.whatwg.org/multipage/infrastructure.html#fetch">fetch</a> for
 <var title="">notification</var>'s <a href="#icon-url">icon URL</a>,
 <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queue a task</a> to
 <a class="external" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">fire an event</a>
 named <code title="">error</code> on <var title="">notification</var>, and
 terminate these steps.

 <li><p>If there is a <a href="#concept-notification" title="concept-notification">notification</a>
 in the <a href="#list-of-pending-notifications">list of pending notifications</a> or the
 <a href="#list-of-active-notifications">list of active notifications</a> whose <a href="#tag">tag</a> equals
 <var title="">notification</var>'s <a href="#tag">tag</a> and whose
 <a href="#origin">origin</a> equals <var title="">notification</var>'s
 <a href="#origin">origin</a>, run the <a href="#replace-steps">replace steps</a> for that
 <a href="#concept-notification" title="concept-notification">notification</a> and
 <var title="">notification</var>, and then terminate these steps.

 <li><p>If the device allows notifications to be displayed immediately
 without limitations on the number of concurrent notifications, run
 the <a href="#display-steps">display steps</a> and terminate these steps.

 <li><p>If the device has limitations on the number of concurrent
 notifications, either immediately call to a notification platform which
 natively supports queueing, or append <var title="">notification</var> to the
 <a href="#list-of-pending-notifications">list of pending notifications</a>.
</ol>

<h3 id="activating-a-notification"><span class="secno">4.6 </span>激活通知</h3>

<p>When a <a href="#concept-notification" title="concept-notification">notification</a>
<var title="">notification</var> is activated by the user, assuming the underlying
notification platform supports activation, the user agent must, for each
<code><a href="#notification">Notification</a></code> object representing <var title="">notification</var>,
<a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queue a task</a> to
<a class="external" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">fire an event</a>
named <code title="">click</code> on the <code><a href="#notification">Notification</a></code> object.

<p class="note">Throughout the web platform "activate" is intentionally misnamed as "click".

<p class="note">User agents are strongly encouraged to make
<code class="external" title="dom-window-focus"><a href="https://html.spec.whatwg.org/multipage/interaction.html#dom-window-focus">window.focus()</a></code> work from within
the event listener for the event named <code title="">click</code> as a means of focusing the
browsing context related to the notification.

<h3 id="closing-a-notification"><span class="secno">4.7 </span>Closing a notification</h3>

<p>When a <a href="#concept-notification" title="concept-notification">notification</a> is closed,
either by the underlying notification platform or by the user, the
<a href="#close-steps">close steps</a> for it must be run.

<p>The <dfn id="close-steps">close steps</dfn> for a given <var title="">notification</var> are:

<ol>
 <li><p>If <var title="">notification</var> is neither in the
 <a href="#list-of-pending-notifications">list of pending notifications</a> nor in the
 <a href="#list-of-active-notifications">list of active notifications</a>, terminate these steps.

 <li><p><a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">Queue a task</a> to remove
 <var title="">notification</var> from either the
 <a href="#list-of-pending-notifications">list of pending notifications</a> or the
 <a href="#list-of-active-notifications">list of active notifications</a>, and
 <a class="external" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">fire an event</a>
 named <code title="">close</code> on <var title="">notification</var>.
</ol>

<h3 id="pending-notifications"><span class="secno">4.8 </span>Pending notifications</h3>

<p>Whenever the <a href="#list-of-pending-notifications">list of pending notifications</a> is not empty, the
user agent must wait and monitor changes in the available notification space
on the device.

<p>When the available display space changes on the device such that a new
notification can be displayed, for example due to a previous notification
being dismissed, the user agent should run the <a href="#display-steps">display steps</a>
for the first <a href="#concept-notification" title="concept-notification">notification</a> in the
<a href="#list-of-pending-notifications">list of pending notifications</a> and then remove it from the
<a href="#list-of-pending-notifications">list of pending notifications</a>.

<h3 id="displaying-notifications"><span class="secno">4.9 </span>Displaying notifications</h3>

<p>The <dfn id="display-steps">display steps</dfn> for a given <var title="">notification</var>
are:

<ol>
 <li>
  <p>If the notification platform supports icons,
  <var title="">notification</var>'s <a href="#icon-url">icon URL</a> is set and has not
  yet been <a class="external" href="https://html.spec.whatwg.org/multipage/infrastructure.html#fetch" title="fetch">fetched</a>,
  <a class="external" href="https://html.spec.whatwg.org/multipage/infrastructure.html#fetch">fetch</a> it and wait for the resource to
  be fully downloaded.

  <p>Once <a class="external" href="https://html.spec.whatwg.org/multipage/infrastructure.html#fetch" title="fetch">fetching</a> has
  finished and the image format is supported, set
  <var title="">notification</var>'s <a href="#icon-image">icon image</a> to the decoded resource.
  (Otherwise <var title="">notification</var> has no <a href="#icon-image">icon image</a>.)

 <li>
  <p><a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">Queue a task</a> to run these substeps:

  <ol>
   <li><p>Display <var title="">notification</var> on the device (e.g. by
   calling the appropriate notification platform).

   <li><p>If displaying fails (e.g. the notification platform returns an
   error),
   <a class="external" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">fire an event</a>
   named <code title="">error</code> on <var title="">notification</var> and
   terminate these steps.

   <li><p>Append <var title="">notification</var> to the
   <a href="#list-of-active-notifications">list of active notifications</a>.

   <li><p><a class="external" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">Fire an event</a>
   named <code title="">show</code> on <var title="">notification</var>.
  </ol>
</ol>


<h3 id="replacing-a-notification"><span class="secno">4.10 </span>Replacing a notification</h3>

<p>The <dfn id="replace-steps">replace steps</dfn> for replacing an <var title="">old</var>
<a href="#concept-notification" title="concept-notification">notification</a> with a
<var title="">new</var> one are:

<ol>
 <li>
  <p>If the notification platform supports icons,
  <var title="">new</var>'s <a href="#icon-url">icon URL</a> is set and has not
  yet been <a class="external" href="https://html.spec.whatwg.org/multipage/infrastructure.html#fetch" title="fetch">fetched</a>,
  <a class="external" href="https://html.spec.whatwg.org/multipage/infrastructure.html#fetch">fetch</a> it and wait for the resource to
  be fully downloaded.

  <p>Once <a class="external" href="https://html.spec.whatwg.org/multipage/infrastructure.html#fetch" title="fetch">fetching</a> has
  finished and the image format is supported, set
  <var title="">new</var>'s <a href="#icon-image">icon image</a> to the decoded resource.
  (Otherwise <var title="">new</var> has no <a href="#icon-image">icon image</a>.)

 <li><p>If <var title="">old</var> is in the
 <a href="#list-of-pending-notifications">list of pending notifications</a>,
 <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queue a task</a> to replace
 <var title="">old</var> with <var title="">new</var>, in the same position, in
 the <a href="#list-of-pending-notifications">list of pending notifications</a>, and
 <a class="external" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">fire an event</a>
 named <code title="">close</code> on <var title="">old</var>.

 <li>
  <p>Otherwise,
  <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queue a task</a> to replace
  <var title="">old</var> with <var title="">new</var>, in the same position, in
  the <a href="#list-of-active-notifications">list of active notifications</a>,
  <a class="external" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">fire an event</a>
  named <code title="">close</code> on <var title="">old</var>, and
  <a class="external" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">fire an event</a>
  named <code title="">show</code> on <var title="">new</var>.

  <p>If the notification platform does not support replacement this
  requirement may be addressed by running the <a href="#close-steps">close steps</a> for
  <var title="">old</var> and then running the <a href="#display-steps">display steps</a> for
  <var title="">new</var>.

  <p class="note">Notification platforms are strongly encouraged to support
  native replacement. It is much nicer.
</ol>



<h2 id="api"><span class="secno">5 </span>API</h2>

<p>A <a href="#concept-notification" title="concept-notification">notification</a> is represented by
a <code><a href="#notification">Notification</a></code> object and can be created by its
<a href="#dom-notification" title="dom-Notification">constructor</a>.

<pre class="idl">[<a href="#dom-notification" title="dom-Notification">Constructor</a>(DOMString <var title="">title</var>, optional <a href="#notificationoptions">NotificationOptions</a> <var title="">options</var>)]
interface <dfn id="notification">Notification</dfn> : <a class="external" href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a> {
  static readonly attribute <a href="#notificationpermission">NotificationPermission</a> <a href="#dom-notification-permission" title="dom-Notification-permission">permission</a>;
  static void <a href="#dom-notification-requestpermission" title="dom-Notification-requestPermission">requestPermission</a>(optional <a href="#notificationpermissioncallback">NotificationPermissionCallback</a> <var title="">callback</var>);

  attribute <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a href="#handler-onclick" title="handler-onclick">onclick</a>;
  attribute <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a href="#handler-onshow" title="handler-onshow">onshow</a>;
  attribute <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a href="#handler-onerror" title="handler-onerror">onerror</a>;
  attribute <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a href="#handler-onclose" title="handler-onclose">onclose</a>;

  readonly attribute DOMString <a href="#dom-notification-title" title="dom-Notification-title">title</a>;
  readonly attribute <a href="#notificationdirection">NotificationDirection</a> <a href="#dom-notification-dir" title="dom-Notification-dir">dir</a>;
  readonly attribute DOMString <a href="#dom-notification-dir" title="dom-Notification-dir">lang</a>;
  readonly attribute DOMString <a href="#dom-notification-dir" title="dom-Notification-dir">body</a>;
  readonly attribute DOMString <a href="#dom-notification-dir" title="dom-Notification-dir">tag</a>;
  readonly attribute DOMString <a href="#dom-notification-dir" title="dom-Notification-dir">icon</a>;

  void <a href="#dom-notification-close" title="dom-Notification-close">close</a>();
};

dictionary <dfn id="notificationoptions">NotificationOptions</dfn> {
  <a href="#notificationdirection">NotificationDirection</a> dir = "auto";
  DOMString lang = "";
  DOMString body;
  DOMString tag;
  DOMString icon;
};

enum <dfn id="notificationpermission">NotificationPermission</dfn> {
  "default",
  "denied",
  "granted"
};

callback <dfn id="notificationpermissioncallback">NotificationPermissionCallback</dfn> = void (<a href="#notificationpermission">NotificationPermission</a> <var title="">permission</var>);

enum <dfn id="notificationdirection">NotificationDirection</dfn> {
  "auto",
  "ltr",
  "rtl"
};</pre>

<p>The
<dfn id="dom-notification" title="dom-Notification"><code>Notification(<var title="">title</var>, <var title="">options</var>)</code></dfn>
constructor must run these steps:

<ol>
 <li><p>Let <var title="">notification</var> be a new
 <a href="#concept-notification" title="concept-notification">notification</a> represented by a
 <code><a href="#notification">Notification</a></code> object.

 <li><p>Set <var title="">notification</var>'s <a href="#title">title</a> to
 <var title="">title</var>.

 <li><p>Set <var title="">notification</var>'s <a href="#direction">direction</a> to
 <var title="">options</var>'s <code title="">dir</code>.

 <li><p>If <var title="">options</var>'s <code title="">lang</code> is a valid
 BCP 47 language tag, or the empty string, set
 <var title="">notification</var>'s <a href="#language">language</a> to
 <var title="">options</var>'s <code title="">lang</code>, or set it to the empty
 string otherwise. <a href="#refsLANG">[LANG]</a>

 <li><p>Set <var title="">notifications</var>'s <a href="#origin">origin</a> to the
 current <a class="external" href="https://tools.ietf.org/html/rfc6454#section-4">origin</a>.

 <li><p>If <var title="">options</var>'s <code title="">body</code> is present,
 set <var title="">notification</var>'s <a href="#body">body</a> to
 <code title="">body</code>.

 <li><p>If <var title="">options</var>'s <code title="">tag</code> is present, set
 <var title="">notification</var>'s <a href="#tag">tag</a> to <code title="">tag</code>.

 <li><p>If <var title="">options</var>'s <code title="">icon</code> is present,
 <a class="external" href="https://url.spec.whatwg.org/#concept-url-parser" title="concept-url-parser">parse</a>
 <code title="">icon</code> using the <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url">API base URL</a>
 specified by the <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>, and if that
 does not return failure, set <var title="">notification</var>'s <a href="#icon-url">icon URL</a> to the
 return value. (Otherwise <a href="#icon-url">icon URL</a> is not set.)

 <li><p>Return <var title="">notification</var>, but continue running these
 steps asynchronouusly.

 <li><p>If the notification platform supports icons, the user agent may
 start <a class="external" href="https://html.spec.whatwg.org/multipage/infrastructure.html#fetch" title="fetch">fetching</a>
 <var title="">notification</var>'s <a href="#icon-url">icon URL</a> at this point, if
 <a href="#icon-url">icon URL</a> is set.

 <li><p>Run the <a href="#show-steps">show steps</a> for <var title="">notification</var>.
</ol>

<p>The static
<dfn id="dom-notification-permission" title="dom-Notification-permission"><code>permission</code></dfn>
attribute must return <a href="#permission-0">permission</a>.

<p>The static
<dfn id="dom-notification-requestpermission" title="dom-Notification-requestPermission"><code>requestPermission(<var title="">callback</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Return, but continue running these steps asynchronously.

 <li><p>Let <var title="">permission</var> be <a href="#permission-0">permission</a>.

 <li><p>If <var title="">permission</var> is "<code title="">default</code>",
 ask the user whether showing notifications for the current
 <a class="external" href="https://tools.ietf.org/html/rfc6454#section-4">origin</a> is acceptable. If it is, set
 <var title="">permission</var> to "<code title="">granted</code>", or
 "<code title="">denied</code>" otherwise.

 <li><p><a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">Queue a task</a> to set
 <a href="#permission-0">permission</a> to <var title="">permission</var> and invoke
 <var title="">callback</var> with <var title="">permission</var> as single
 argument if <var title="">callback</var> is given.
</ol>

<p class="warning">In designing the platform notifications are the one
instance thus far where asking the user upfront makes sense. Specifications
for other APIs should not use this pattern and instead employ one of the
<a href="http://robert.ocallahan.org/2011/06/permissions-for-web-applications_30.html">many more suitable alternatives</a>.

<p>The following are the <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers">event handlers</a>
(and their corresponding
<a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" title="event handler event type">event handler event types</a>)
that must be supported as attributes by the <code><a href="#notification">Notification</a></code> object.

<table>
 <thead>
  <tr>
   <th><a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" title="event handlers">event handler</a>
   <th><a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type">event handler event type</a>
 <tbody>
  <tr>
   <td><dfn id="handler-onclick" title="handler-onclick"><code>onclick</code></dfn>
   <td><code title="event-click">click</code>
  <tr>
   <td><dfn id="handler-onshow" title="handler-onshow"><code>onshow</code></dfn>
   <td><code title="event-show">show</code>
  <tr>
   <td><dfn id="handler-onerror" title="handler-onerror"><code>onerror</code></dfn>
   <td><code title="event-error">error</code>
  <tr>
   <td><dfn id="handler-onclose" title="handler-onclose"><code>onclose</code></dfn>
   <td><code title="event-close">close</code>
</table>

<p>The <dfn id="dom-notification-close" title="dom-Notification-close"><code>close()</code></dfn> method
must run the <a href="#close-steps">close steps</a> for the
<a href="#concept-notification" title="concept-notification">notification</a>.

<p>The <dfn id="dom-notification-title" title="dom-Notification-title"><code>title</code></dfn> attribute must return the
<a href="#concept-notification" title="concept-notification">notification</a>'s <a href="#title">title</a>.

<p>The <dfn id="dom-notification-dir" title="dom-Notification-dir"><code>dir</code></dfn> attribute must return the
<a href="#concept-notification" title="concept-notification">notification</a>'s <a href="#direction">direction</a>.

<p>The <dfn id="dom-notification-lang" title="dom-Notification-lang"><code>lang</code></dfn> attribute must return the
<a href="#concept-notification" title="concept-notification">notification</a>'s <a href="#language">language</a>.

<p>The <dfn id="dom-notification-body" title="dom-Notification-body"><code>body</code></dfn> attribute must return the
<a href="#concept-notification" title="concept-notification">notification</a>'s <a href="#body">body</a> and the empty
string otherwise.

<p>The <dfn id="dom-notification-tag" title="dom-Notification-tag"><code>tag</code></dfn> attribute must return the
<a href="#concept-notification" title="concept-notification">notification</a>'s <a href="#tag">tag</a> and the empty
string otherwise.

<p>The <dfn id="dom-notification-icon" title="dom-Notification-icon"><code>icon</code></dfn> attribute must return the
<a href="#concept-notification" title="concept-notification">notification</a>'s <a href="#icon-url">icon URL</a>,
<a class="external" href="https://url.spec.whatwg.org/#concept-url-serializer" title="concept-url-serializer">serialized</a>, and the
empty string otherwise.



<h2 id="examples"><span class="secno">6 </span>示例</h2>

<h3 id="using-events"><span class="secno">6.1 </span>使用事件</h3>

<p><code>开发者可以使用 <a href="#notification">Notification</a></code> 
对象在其生命周期内发出的事件来产生所需要的行为。 

<p>当向用户显示
<a href="#concept-notification" title="concept-notification">notification</a> 时，
会触发 <code title="event-show">show</code> 事件
&mdash; 当显示区域受限制并且有队列时，可能要在创建通知一段时间后才能触发事件。

<p>下述示例表明，不管通知在什么时间显示，其都会在展示 15 秒之后被关闭。

<pre class="example">var notification = new Notification("New Email Received", { icon: "mail.png" })
notification.onshow = function() { setTimeout(notification.close, 15000) }</pre>

<p>当用户关闭通知时， 会触发 <code title="event-close">close</code> 事件。
开发人员可使用该事件在用户确认通知之后处理一些操作。 

<p>下述示例表明，当一个会议提醒通知得到确认之后，应用程序将会停止其他形式的提醒。

<pre class="example">var notification = new Notification("Meeting about to begin", { icon: "calendar.gif", body: "Room 101" })
notification.onclose = function(event) { cancelReminders(event) }</pre>


<h3 id="tags-example"><span class="secno">6.2 </span>多实例使用 <code title="">tag</code> 成员</h3>

<p>Web 应用程序常常在多实例中进行并发操作，比如用户在多个浏览器标签中打开一个邮件
应用程序。由于桌面是一种共享资源，通知应用编程接口通过 <code title="">tag</code> 成员
提供一种很容易协调的方式进行通知。 

<p>表示相同概念的事件可以使用相同的标记，当两个通知同时显示时，用户只会收到一个通知。

<pre class="example" title="">
实例 1                                        | 实例 2
                                             |
// 有个新邮件通知的实例。                          |
new Notification("New mail from John Doe",   |
                 { tag: 'message1' });       |
                                             |
                                             |  // 稍后该实例通知有个新邮件。
                                             |  new Notification("New mail from John Doe",
                                             |                   { tag: 'message1' });</pre>

<p>如果用户代理遵循这里的算法，这种情况的结果就是，用户收到<strong>单一的</strong>通知
  "New mail from John Doe"。

<h3 id="using-the-tag-member-for-a-single-instance"><span class="secno">6.3 </span>单实例使用 <code title="">tag</code> 成员</h3>

<p>单实例应用程序也可以使用 <code title="">tag</code> 成员来尽可能保持其通知的最新状态变化。

<p>例如，Alice 和 Bob 正在使用一个聊天应用程序，当 Alice 空闲时 Bob 发送了多条信息，
应用程序可能更倾向于 Alice 没有看到每个消息的通知界面。

<pre class="example">// Bob 说 "Hi"
new Notification("Bob: Hi", { tag: 'chat_Bob' });

// Bob 说 "Are you free this afternoon?"
new Notification("Bob: Hi / Are you free this afternoon?", { tag: 'chat_Bob' });</pre>

<p>这种情况的结果就是<em>单一的</em>通知；第二条消息会替换第一条消息，因为它们具有相同的标签。
在该队列通知（先进先出）平台，使用标签允许通知保持其在队列中的位置。在总是最先显示最新通知的平台里，
也可以使用 <code title="dom-Notification-close"><a href="#dom-notification-close">close()</a></code> 方法实现类似的结果。


<h2 class="no-num" id="references">参考文献</h2>

<div id="anolis-references"><dl><dt id="refsBIDI">[BIDI]
<dd><cite><a href="http://www.unicode.org/reports/tr9/">Unicode Bidirectional Algorithm</a></cite>, Mark Davis. Unicode Consortium.

<dt id="refsDOM">[DOM]
<dd><cite><a href="https://dom.spec.whatwg.org/">DOM</a></cite>, Anne van Kesteren, Aryeh Gregor and Ms2ger. WHATWG.

<dt id="refsHTML">[HTML]
<dd><cite><a href="https://html.spec.whatwg.org/multipage/">HTML</a></cite>, Ian Hickson. WHATWG.

<dt id="refsLANG">[LANG]
<dd><cite><a href="https://tools.ietf.org/html/bcp47">Tags for Identifying Languages; Matching of Language Tags</a></cite>, Addison Phillips and Mark Davis. IETF.

<dt id="refsRFC2119">[RFC2119]
<dd><cite><a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a></cite>, Scott Bradner. IETF.

<dt id="refsURL">[URL]
<dd><cite><a href="https://url.spec.whatwg.org/">URL</a></cite>, Anne van Kesteren. WHATWG.

<dt id="refsWEBIDL">[WEBIDL]
<dd><cite><a href="https://heycam.github.io/webidl/">Web IDL</a></cite>, Cameron McCormack. W3C.

</dl></div>



<h2 class="no-num" id="acknowledgments">致谢</h2>

<p>感谢牛人：
Aharon (Vladimir) Lanin、
Alex Russell、
David H&aring;s&auml;ther、
Doug Turner、
Drew Wilson、
Jake Archibald、
Edward O'Connor、
Frederick Hirsch、
Ian Hickson、
James Graham、
Jon Lee、
Jonas Sicking、
Michael Cooper、
Michael Henretty、
Olli Pettay 和
Simon Pieters。
非常棒。

特别感谢 Anne van Kesteren 持续不断地推进
WHATWG 的 <a href="https://notifications.spec.whatwg.org/">
通知应用编程接口标准</a>。
